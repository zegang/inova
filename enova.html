<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"></link>
   <style type="text/css">
       .panel-purple{width:100%;height:490px;border-color:rgba(123, 6, 100, 1);}
       .panel-purple > .panel-heading{height:40px;text-align:center;background-image:none;background-color:rgba(123, 6, 100, 1);color:white;}
       .imageslogo{background-image:url('imageslogo.png')}
       .ericsson-font{font-family:"Ericsson Capital TT"}
       body{margin:0;padding:0;height:100%;}
       .out-standing-label{padding:6px;background-color:rgba(230, 230, 230, 1);border-radius:6px;}
       .panel-grey{border-color:rgba(244, 244, 244, 1);}
       .panel-grey > .panel-heading{background-color:rgba(244, 244, 244, 1);font-family:"Ericsson Capital TT";}
       .v-left{float:left;}
       .panel-heading{text-align:center;}
       .panel-primary{border-color:rgba(0, 37, 97, 1) !important;}
       .header{margin-top:0;padding:0 50px 0px 50px;border:0 !important;}
       .header_line{width:100%;height:5px;background-image:url(ericssonline.png);background-size:100% 100%;background-repeat:no-repeat;}
       .middle{margin:0 2% 0  2%;}
       #devicesContainer{width:60%;float:left;}
       #devicesContainer .panel{min-width:350px;padding:0;margin:5px 5px;}
       #dockerimagesContainer .panel{padding:0;margin:5px 3px;}
       .device-div{height:420px}
       .device-div > .panel-heading{background-image:none;background-color:rgba(0, 37, 97, 1) !important;}
       .panel-primary > .panel-heading{background-image:none;background-color:rgba(0, 37, 97, 1) !important;}
       .images-div{min-height:500px;width:15%;margin-top:20px;float:left;}
       .image-div{border-color:rgba(127, 194, 66, 1);}
       .image-div > .panel-heading{background-image:none;background-color:rgba(127, 194, 66, 1);color:white;}
       .input-group{margin:5px 0px;}
       .eIconLogo{float:left;width:70px;height:63px;margin-top:-10px;margin-left:-20px;margin-right:10px;background-image:url('data:image/svg+xml;charset=US-ASCII,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%3C!DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%20Tiny%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11-tiny.dtd%22%3E%3Csvg%20version%3D%221.1%22%20baseProfile%3D%22tiny%22%20id%3D%22Layer_1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20%20x%3D%220px%22%20y%3D%220px%22%20width%3D%2271%22%20height%3D%2262.8%22%20viewBox%3D%22-37%20-15.8%2071%2062.8%22%20xml%3Aspace%3D%22preserve%22%3E%3Cg%3E%20%3Cg%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M-12%2C0.6c-2.1%2C0.8-4.5-0.3-5.3-2.5c-0.8-2.1%2C0.3-4.5%2C2.5-5.3l22.7-8.4c2.1-0.8%2C4.5%2C0.3%2C5.3%2C2.5%20%20%20c0.8%2C2.1-0.3%2C4.5-2.5%2C5.3L-12%2C0.6z%22%2F%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M-12%2C12.9c-2.1%2C0.8-4.5-0.3-5.3-2.5c-0.8-2.1%2C0.3-4.5%2C2.5-5.3L7.9-3.3C10-4%2C12.4-3%2C13.2-0.8%20%20%20c0.8%2C2.1-0.3%2C4.5-2.5%2C5.3L-12%2C12.9z%22%2F%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M-12%2C25.2c-2.1%2C0.8-4.5-0.3-5.3-2.5c-0.8-2.1%2C0.3-4.5%2C2.5-5.3L7.9%2C9.2c2.1-0.8%2C4.5%2C0.3%2C5.3%2C2.5%20%20%20c0.8%2C2.1-0.3%2C4.5-2.5%2C5.3L-12%2C25.2z%22%2F%3E%20%3C%2Fg%3E%20%3Cg%3E%20%20%3Cpolygon%20fill%3D%22%23002561%22%20points%3D%22-37%2C35.4%20-29.3%2C35.4%20-29.3%2C37.4%20-34.3%2C37.4%20-34.3%2C39.2%20-29.5%2C39.2%20-29.5%2C41.4%20-34.3%2C41.4%20%20%20%20-34.3%2C43.2%20-29.3%2C43.2%20-29.3%2C45.3%20-37%2C45.3%20%20%20%22%2F%3E%20%20%3Cpolygon%20fill%3D%22%23002561%22%20points%3D%22-17.6%2C35.4%20-14.8%2C35.4%20-14.8%2C45.3%20-17.6%2C45.3%20%20%20%22%2F%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M-5%2C35.8l-0.2%2C2.1c-2.2-1.3-5.6-0.9-5.6%2C2.5c-0.1%2C3.3%2C3.5%2C3.8%2C5.7%2C2.7l0.1%2C2.2c-4%2C1.2-8.7%2C0-8.7-4.9%20%20%20C-13.5%2C35.6-8.7%2C34.3-5%2C35.8L-5%2C35.8z%22%2F%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M3%2C35.6l-0.2%2C2.1c-1.4-0.8-4-0.8-4%2C0.4c0%2C1.8%2C4.6%2C0.5%2C4.6%2C4.3C3.4%2C46-1%2C46-3.9%2C45.2l0.2-2.2%20%20%20c1.8%2C0.8%2C4.3%2C1%2C4.3-0.4c0-1.6-4.7-0.7-4.7-4.3C-3.9%2C35.4-0.3%2C34.6%2C3%2C35.6L3%2C35.6z%22%2F%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M11.2%2C35.6L11%2C37.6c-1.4-0.8-4-0.8-4%2C0.4c0%2C1.8%2C4.6%2C0.5%2C4.6%2C4.3c0%2C3.7-4.4%2C3.7-7.3%2C2.9L4.5%2C43%20%20%20c1.8%2C0.8%2C4.3%2C1%2C4.3-0.4c0-1.6-4.7-0.7-4.7-4.3C4.3%2C35.4%2C7.9%2C34.6%2C11.2%2C35.6L11.2%2C35.6z%22%2F%3E%20%20%3Cpolygon%20fill%3D%22%23002561%22%20points%3D%2223.7%2C35.4%2027.1%2C35.4%2030.4%2C41.8%2030.4%2C35.4%2032.9%2C35.4%2032.9%2C45.3%2029.7%2C45.3%2026.2%2C38.8%2026.2%2C45.3%20%20%20%2023.7%2C45.3%20%20%20%22%2F%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M17.4%2C35.2c2.8%2C0%2C5%2C1.7%2C5%2C5.3c0%2C3.5-2.2%2C5.2-5%2C5.2s-5-1.7-5-5.2C12.5%2C36.8%2C14.6%2C35.2%2C17.4%2C35.2L17.4%2C35.2z%20%20%20%20M15.2%2C40.4c0%2C1.5%2C0.7%2C3.3%2C2.2%2C3.3c1.5%2C0%2C2.2-1.7%2C2.2-3.3c0-1.4-0.7-3.2-2.2-3.3C15.9%2C37.2%2C15.2%2C38.8%2C15.2%2C40.4L15.2%2C40.4z%22%2F%3E%20%20%3Cpath%20fill%3D%22%23002561%22%20d%3D%22M-24.9%2C39.5h1.5c0.7%2C0%2C1.3-0.4%2C1.3-1.1c0-0.7-0.5-1.1-1.2-1.1h-1.5L-24.9%2C39.5L-24.9%2C39.5z%20M-27.4%2C35.4%20%20%20h4.9c1.3%2C0%2C3.2%2C0.6%2C3.2%2C2.7c0%2C1.3-0.6%2C2.1-1.8%2C2.4c0.1%2C0%2C0.7%2C0.3%2C0.9%2C1l1.4%2C3.9h-2.9l-1-3c-0.2-0.5-0.5-0.8-1-0.8%20%20%20c-0.4%2C0-1.1%2C0-1.1%2C0v3.8h-2.6V35.4L-27.4%2C35.4z%22%2F%3E%20%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E');}
   </style>
<title>Distributed VNF at network edge</title>
</head>
<body>
    <div class="header page-header container-fluid">
        <h1><div class="eIconLogo"></div><span class="ericsson-font">Distributed VNF at network edge</span></h1>
    </div>

    <div src="./ericssonline.png" class="header_line"></div>

    <div class="middle">
        <div class="images-div container-fluid">
            <div class="row panel panel-purple">
                <div class="panel-heading">
                    <div class="panel-title">
                        <div class="v-left">
                             <span class="ericsson-font">Images<span>
                        </div>
                        <button id="addimageBtn" type="button" class="pull-right btn btn-default" style="padding:3px 3px;margin-top:-2px" onclick="showAddModal()"><span class="glyphicon glyphicon-plus-sign"></span></button>
                    </div>
                </div>
                <div id="dockerimagesContainer" class="panel-body panel-collapse collapse in"></div>
           </div>
        </div>

   	<div id="devicesContainer" class="panel-body panel-collapse collapse in"></div>
   </div>
 
   </div>
   <div  style="float:right;margin:20px 10px;margin-right:30px;height:500px;width:280px;background-image:url('enovalogo.png');background-repeat:no-repeat;background-size:100% 100%;"></div>

  <!-- Modal -->
<div class="modal fade" id="addImgToDevModal" tabindex="-1" role="dialog" aria-labelledby="addImgToDevModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="addImgToDevModalLabel">Add Image to Device</h4>
      </div>
      <div class="modal-body">
           <div class="input-group">
               <span class="input-group-addon">Device</span>
               <input id="addImgToDevModal_device" type="text" class="form-control" placeholder="docker image title" readonly="true">
          </div>
           <div class="input-group">
               <span class="input-group-addon">Title</span>
               <input id="addImgToDevModal_title" type="text" class="form-control" placeholder="docker image title">
          </div>
      </div>
       <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-default" onclick="addImgToDevModal_add_click(event)">Add</button>
      </div>
    </div>
  </div>
</div>

   <!-- Modal -->
<div class="modal fade" id="imgOptModal" tabindex="-1" role="dialog" aria-labelledby="imgOptModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="imgOptModalLabel">Image Operation</h4>
      </div>
      <div class="modal-body">
              <input id="imgOptModal_device" type="hidden">
           <div class="input-group">
               <span class="input-group-addon">Title</span>
               <input id="imgOptModal_title" type="text" class="form-control" placeholder="docker image title" readonly>
          </div>
          <div class="input-group">
               <span class="input-group-addon">URL</span>
               <input id="imgOptModal_url" type="text" class="form-control" placeholder="docker image url" readonly>
          </div>
          <div class="input-group">
               <span class="input-group-addon">Config</span>
               <input id="imgOptModal_Config" type="text" class="form-control" placeholder="docker image config" readonly>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" onclick="imgOptModal_delete_click()">Delete</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-default" onclick="imgOptModal_start_click()">Start</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="imageAddModal" tabindex="-2" role="dialog" aria-labelledby="imageAddModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 id="imageAddModal_head" class="modal-title">Add a Docker Image</h4>
      </div>
      <div class="modal-body">
          <div class="input-group">
               <span class="input-group-addon">Title</span>
               <input id="imgAddModal_title" type="text" class="form-control" placeholder="docker image title">
          </div>   
          <div class="input-group">
               <span class="input-group-addon">URL</span>
               <input id="imgAddModal_url" type="text" class="form-control" placeholder="docker image url">
          </div>   
          <div class="input-group">
               <span class="input-group-addon">Config</span>
               <input id="imgAddModal_Config" type="text" class="form-control" placeholder="docker image config">
          </div>   
      </div>
      <div class="modal-footer">
        <button id="imgAddModal_delete_btn" type="button" class="btn btn-default" onclick="imgAddModal_delete_click()">Delete</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button id="imgAddModal_save_btn" type="button" class="btn btn-default" onclick="imgAddModal_save_click()">Save</button>
        <button id="imgAddModal_add_btn" type="button" class="btn btn-default" onclick="imgAddModal_add_click()">Add</button>
      </div>
    </div>
  </div>
</div>

   <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
   <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
   <script src="./enova.js"></script>
   <script type="text/javascript">
	function allowDrop(ev){
		ev.preventDefault();
	}

	function drag(ev){
		ev.dataTransfer.setData("Text",ev.target.id);
	}
	
	function drop(ev){
	        ev.preventDefault();
		var imgName=ev.dataTransfer.getData("Text");
                var deviceName = $(ev.target).children("input").val();
                $.ajax({
                  type: "POST",
                  url: serverurl + "/device/" + deviceName +"/" + escape(imgName),
                  complete: function(){$('<tr><td>#</td><td>' + imgName+ '</td><td><button class="img-op-btn" onclick="showImgOptModal(\''+deviceName+ '\',\'' + imgName +'\')" type="button"><span class="glyphicon glyphicon-cog"></span></button></td></tr>').insertBefore($(ev.target).closest('tbody').children('tr').last());}
                });
	}

        function showAddModal(){ 
                $("#imageAddModal_head").html("Add a Docker Image");
                $("#imageAddModal input").val("");
                $("#imgAddModal_title").attr('readonly', false);
                $("#imgAddModal_delete_btn").hide();
                $("#imgAddModal_save_btn").hide();
                $("#imgAddModal_add_btn").show();
                $("#imageAddModal").modal('show');
        }

        function imgAddModal_add_click(){
                var imgObj = { "name": $("#imgAddModal_title").val(),
                               "uri": $("#imgAddModal_url").val(),
                               "Config": $("#imgAddModal_Config").val()
                             };
                addImage(imgObj);        
        }

        function imgAddModal_delete_click(imgName){
              $.ajax({
                  type: "DELETE",
                  url: "http://146.11.24.216:8010/image/" + $("#imgAddModal_title").val(),
                  complete: function(result){ getDockerImages();}
              });
              $("#imageAddModal").modal('hide');
        }

        function imgAddModal_save_click(){
              var imgName = $("#imgAddModal_title").val(); 
              var imgObj = { "name": imgName,
                             "uri": $("#imgAddModal_url").val(),
                             "Config": $("#imgAddModal_Config").val()
                           };
              $.ajax({
                  type: "PUT",
                  url: serverurl + "/image/" + imgName,
                  contentType: "application/json",
                  data: JSON.stringify(imgObj),
                  complete: function(){getDockerImages();}
              });
              $("#imageAddModal").modal('hide');
        }

        function showImgOptModal(deviceName, imgName){
            $("#imgOptModal_device").val(deviceName);
            $("#imgOptModal_title").val(imgName);
            var obj = images.find(function(element){return element.name == imgName;});
            if(obj){
                $("#imgOptModal_url").val(obj.uri);
                $("#imgOptModal_Config").val(obj.Config);
            }
            $("#imgOptModal").modal('show');
        }

        function imgOptModal_start_click(){
           var imgName=$("#imgOptModal_title").val();
           var devName=$("#imgOptModal_device").val();
           $.ajax({
                  type: "POST",
                  url: serverurl + "/job/" + devName + "/" + escape(imgName) + "/start",
                  complete: function(){}
              });
           $("#imgOptModal").modal('hide');
        }

        function imgOptModal_delete_click(){
           var imgName=$("#imgOptModal_title").val();
           var devName=$("#imgOptModal_device").val();
           $.ajax({
                  type: "DELETE",
                  url: serverurl + "/device/" + devName + "/" + escape(imgName), 
                  complete: function(){refreshPage();}
              });
           $("#imgOptModal").modal('hide');
        }

        function imgOptModal_save_click(){
           var imgName=$("#imgOptModal_title").val();
           var devName=$("#imgOptModal_device").val();
           var imgObj = { "name": imgName,
                          "uri": $("#imgOptModal_url").val(),
                          "Config": $("#imgOptModal_Config").val()
                        };
           $.ajax({
                  type: "PUT",
                  url: serverurl + "/device/" + devName + "/" + escape(imgName),
                  contentType: "application/json",
                  data: JSON.stringify(imgObj),
                  complete: function(){}
              });
           $("#imgOptModal").modal('hide');
        }
   
        function addImgToDevModal_add_click(ev){
            var imgName=$("#addImgToDevModal_title").val();
            var devName=$("#addImgToDevModal_device").val();
            var tableName = devName + "_img_table";
            $.ajax({
                  type: "POST",
                  url: serverurl + "/device/" + devName + "/" + escape(imgName),
                  complete: function(){$('<tr><td>2</td><td>' + imgName+ '</td><td><button class="img-op-btn" onclick="showImgOptModal(\''+devName+ '\',\'' + imgName +'\')" type="button"><span class="glyphicon glyphicon-cog"></span></button></td></tr>').insertBefore($('#' +tableName+ ' tbody').children('tr').last());}
              });
           $("#addImgToDevModal").modal('hide');

        }

        function job_stop_click(deviceName, jobName){
            $.ajax({
                  type: "DELETE",
                  url: serverurl + "/job/" + deviceName + "/" + escape(jobName) + "/stop",
                  complete: function(){}
              });
        }

        function job_pause_click(deviceName, jobName){
            $.ajax({
                  type: "PUT",
                  url: serverurl + "/job/" + deviceName + "/" + jobName + "/pause",
                  complete: function(){}
              });
        }

        function job_resume_click(deviceName, jobName){
            $.ajax({
                  type: "PUT",
                  url: serverurl + "/job/" + deviceName + "/" + jobName + "/resume",
                  complete: function(){}
              });
        }

        function refreshPage(){
		getDevices();
		getDockerImages();

        }

        $(document).ready(function(){
                refreshPage();
                setInterval(refreshPage, 30000); 
	});
             
   </script>
</body>
</html>
