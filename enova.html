<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"></link>
   <style type="text/css">
       body{margin:0;padding:0;}
       .header{margin-top:0;padding:0 50px;border-bottom:2px solid }
       .middle{margin:0 2% 0  2%;}
       #devicesContainer .panel{min-width:400px;padding:0;margin:5px 15px;}
       #dockerimagesContainer .panel{min-width:210px;padding:0;margin:5px 15px;}
       .device-div{height:420px}
       .image-div{height:150px}
       .input-group{margin:5px 0px;}
   </style>
<title>Enova</title>
</head>
<body>
    <div class="header page-header container-fluid">
        <h1>Enova</h1>
    </div>
   <div class="middle">
    <div class="container-fluid">
        <div class="row panel panel-info">
		<div class="panel-heading">
		<h3 class="panel-title" data-toggle="collapse" href="#devicesContainer" aria-expanded="true" aria-controls="devicesContainer">Devices</h3>
    		</div>
    		<div id="devicesContainer" class="panel-body panel-collapse collapse in"></div>            
        </div>
   </div>

   <div class="container-fluid">
        <div class="row panel panel-danger">
		<div class="panel-heading">
                    <div class="panel-title" style="height:30px">
                        <div class="pull-left" data-toggle="collapse" href="#dockerimagesContainer" aria-expanded="true" aria-controls="dockerimagesContainer" style="width:100px">Images</div>
                        <button id="addimageBtn" type="button" class="pull-right btn btn-default" onclick="showAddModal()"><span class="glyphicon glyphicon-plus-sign"></span></button>
                    </div>
    		</div>
    		<div id="dockerimagesContainer" class="panel-body panel-collapse collapse in"></div>            
        </div>
   </div>
   </div>

   <!-- Modal -->
<div class="modal fade" id="imgOptModal" tabindex="-1" role="dialog" aria-labelledby="imgOptModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="imgOptModalLabel">Image Operation</h4>
      </div>
      <div class="modal-body">
           <div class="input-group">
               <span class="input-group-addon">Title</span>
               <input id="imgOptModal_title" type="text" class="form-control" placeholder="docker image title">
          </div>
          <div class="input-group">
               <span class="input-group-addon">URL</span>
               <input id="imgOptModal_url" type="text" class="form-control" placeholder="docker image url">
          </div>
          <div class="input-group">
               <span class="input-group-addon">Config</span>
               <input id="imgOptModal_Config" type="text" class="form-control" placeholder="docker image config">
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Delete</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-default" onclick="imgOptModal_start_click()">Start</button>
        <button type="button" class="btn btn-default" >Stop</button>
        <button type="button" class="btn btn-default">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="imageAddModal" tabindex="-2" role="dialog" aria-labelledby="imageAddModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 id="imageAddModal_head" class="modal-title">Add a Docker Image</h4>
      </div>
      <div class="modal-body">
          <div class="input-group">
               <span class="input-group-addon">Title</span>
               <input id="imgAddModal_title" type="text" class="form-control" placeholder="docker image title">
          </div>   
          <div class="input-group">
               <span class="input-group-addon">URL</span>
               <input id="imgAddModal_url" type="text" class="form-control" placeholder="docker image url">
          </div>   
          <div class="input-group">
               <span class="input-group-addon">Config</span>
               <input id="imgAddModal_Config" type="text" class="form-control" placeholder="docker image config">
          </div>   
      </div>
      <div class="modal-footer">
        <button id="imgAddModal_delete_btn" type="button" class="btn btn-default" onclick="imgAddModal_delete_click()">Delete</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button id="imgAddModal_save_btn" type="button" class="btn btn-default" onclick="imgAddModal_save_click()">Save</button>
        <button id="imgAddModal_add_btn" type="button" class="btn btn-default" onclick="imgAddModal_add_click()">Add</button>
      </div>
    </div>
  </div>
</div>

   <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
   <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
   <script src="./enova.js"></script>
   <script type="text/javascript">
	function allowDrop(ev){
		ev.preventDefault();
	}

	function drag(ev){
		ev.dataTransfer.setData("Text",ev.target.id);
	}
	
	function drop(ev){
		ev.preventDefault();
		var imgName=ev.dataTransfer.getData("Text");
                var obj = images.find(function(element){return element.name == imgName;});
              $.ajax({
                  type: "POST",
                  url: serverurl + "/droid/" + imgName,
                  dataType: "json",
                  data: JSON.stringify(obj),
                  complete: function(){$('<tr><td>#</td><td>' + imgName+ '</td></tr>').insertBefore($(ev.target).closest('tbody').children('tr').last());}
              });
	}

        function showAddModal(){ 
                $("#imageAddModal_head").html("Add a Docker Image");
                $("#imageAddModal input").val("");
                $("#imgAddModal_title").attr('readonly', false);
                $("#imgAddModal_delete_btn").hide();
                $("#imgAddModal_save_btn").hide();
                $("#imgAddModal_add_btn").show();
                $("#imageAddModal").modal('show');
        }

        function imgAddModal_add_click(){
                var imgObj = { "name": $("#imgAddModal_title").val(),
                               "uri": $("#imgAddModal_url").val(),
                               "Config": $("#imgAddModal_Config").val()
                             };
                addImage(imgObj);        
        }

        function imgAddModal_delete_click(imgName){
              $.ajax({
                  type: "DELETE",
                  url: "http://146.11.24.216:8010/image/" + $("#imgAddModal_title").val(),
                  complete: function(result){ getDockerImages();}
              });
              $("#imageAddModal").modal('hide');
        }

        function imgAddModal_save_click(){
              var imgName = $("#imgAddModal_title").val(); 
              var imgObj = { "name": imgName,
                             "uri": $("#imgAddModal_url").val(),
                             "Config": $("#imgAddModal_Config").val()
                           };
              $.ajax({
                  type: "PUT",
                  url: serverurl + "/image/" + imgName,
                  contentType: "application/json",
                  data: JSON.stringify(imgObj),
                  complete: function(){getDockerImages();}
              });
              $("#imageAddModal").modal('hide');
        }

        function showImgOptModal(imgName){
            $("#imgOptModal_title").val(imgName);
            var obj = images.find(function(element){return element.name == imgName;});
            if(obj){
                $("#imgOptModal_url").val(obj.uri);
                $("#imgOptModal_Config").val(obj.Config);
            }
            $("#imgOptModal").modal('show');
        }

        function imgOptModal_start_click(){

        }

        $(document).ready(function(){
		getDevices();
		getDockerImages();
	});
             
   </script>
</body>
</html>
